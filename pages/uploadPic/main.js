require("../../@babel/runtime/helpers/Arrayincludes"),require("../../common/manifest.js"),require("../../common/vendor.js"),global.webpackJsonpMpvue([1],{"0WIp":function(e,t,o){var i=o("sMl9"),n=o("xZQz"),a=o("ybqe")(i.a,n.a,(function(e){o("Sxe5")}),null,null);t.a=a.exports},FzxF:function(e,t,o){t.a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e._canvasId?o("canvas",{style:{width:e._width+"px",height:e._height+"px",background:"rgba(0, 0, 0, .8)"},attrs:{canvasId:e._canvasId,"disable-scroll":"",eventid:"0"},on:{touchstart:e.touchstart,touchmove:e.touchmove,touchend:e.touchend}}):e._e(),e._v(" "),e._targetId?o("canvas",{style:{position:"fixed",top:-e._width*e._pixelRatio+"px",left:-e._height*e._pixelRatio+"px",width:e._width*e._pixelRatio+"px",height:e._height*e._pixelRatio+"px"},attrs:{"canvas-id":e._targetId,"disable-scroll":""}}):e._e()])},staticRenderFns:[]}},LU4e:function(e,t){},Sxe5:function(e,t){},WaMn:function(e,t,o){Object.defineProperty(t,"__esModule",{value:!0});var i=o("5nAL"),n=o.n(i),a=o("0WIp");new n.a(a.a).$mount()},Y2v8:function(e,t,o){var i=o("ugYC"),n=o("FzxF"),a=o("ybqe")(i.a,n.a,(function(e){o("LU4e")}),null,null);t.a=a.exports},sMl9:function(e,t,o){var i=o("Dd8w"),n=o.n(i),a=o("0xDb"),c=o("uzBN"),r=o("p5Kd"),s=o("NYxO"),p=o("Y2v8"),u=o("IcnI"),l=void 0;t.a={name:"UploadPic",data:function(){return{flag:0,selectType:"album",imageType:"image",type:"0",srcSuffix:"jpg",cropperOpt:{id:"cropper",targetId:"targetCropper",outputSize:1,width:0,height:0,scale:2.5,zoom:8,cut:{}}}},computed:n()({},Object(s.b)(["baseInfo"])),components:{MpvueCropper:p.a},methods:{initCropper:function(e){var t=wx.getSystemInfoSync(),o=t.windowWidth,i=t.windowHeight-50;if(this.cropperOpt.width=o,this.cropperOpt.height=i,this.cropperOpt.pixelRatio=t.pixelRatio,e){var n=JSON.parse(e.cropperOption);this.selectType=n.selectType,this.imageType=n.imageType,this.backUrl=n.backUrl;var a=isNaN(n.wd)&&n.wd.includes("rpx")?Number(n.wd.split("rpx")[0]):Number(n.wd),c=isNaN(n.ht)&&n.ht.includes("rpx")?Number(n.ht.split("rpx")[0]):Number(n.ht);this.cropperOpt.cut={x:(o-a)/2,y:(i-c)/2,width:a,height:c}}},cropperReady:function(){},cropperBeforeImageLoad:function(){},cropperLoad:function(){},cropperBeforeDraw:function(){},uploadTap:function(){var e=this;wx.chooseImage({count:1,sizeType:["original"],sourceType:[this.selectType],success:function(t){if(t.tempFiles[0].size/1024/1024>8)wx.showToast({title:"图片不能超过8M",icon:"none",mask:!0,success:function(e){}});else{var o=t.tempFilePaths[0],i=t.tempFilePaths[0].split("."),n=i[i.length-1].toLowerCase();e.srcSuffix=n,"jpg"===n||"png"===n||"jpeg"===n?(wx.showLoading({title:"图片加载中...",mask:!0,success:function(e){}}),l.pushOrigin(o),wx.hideLoading()):wx.showToast({title:"请上传jpg，jpeg，png格式图片",icon:"none",mask:!0,success:function(e){}})}},fail:function(){u.a.commit("SET_IMAGEURL",""),wx.navigateBack({delta:1})}})},uploadTapAgain:function(){var e=this;wx.chooseImage({count:1,sizeType:["original"],sourceType:["album","camera"],success:function(t){if(t.tempFiles[0].size/1024/1024>8)wx.showToast({title:"图片不能超过8M",icon:"none",mask:!0,success:function(e){}});else{var o=t.tempFilePaths[0],i=t.tempFilePaths[0].split("."),n=i[i.length-1].toLowerCase();e.srcSuffix=n,"jpg"===n||"png"===n||"jpeg"===n?(wx.showLoading({title:"图片加载中...",mask:!0,success:function(e){}}),l.pushOrigin(o),wx.hideLoading()):wx.showToast({title:"请上传jpg，jpeg，png格式图片",icon:"none",mask:!0,success:function(e){}})}},fail:function(){}})},getCropperImage:function(){var e=this,t=this;if(0===this.flag){this.flag=1,wx.showLoading({title:"上传中..."});var o=this.cropperOpt.cut.width,i=this.cropperOpt.cut.height;l.getCropperImage({destWidth:o<375?2*o:o,destHeight:o<375?2*i:i,quality:"1",fileType:t.srcSuffix}).then((function(e){t.uploadImg(e,"cutSrc")})).catch((function(t){wx.hideLoading(),e.flag=0,console.error("获取图片失败")}))}},uploadImg:function(e){var t=this;wx.getImageInfo({src:e,success:function(o){"unknown"===o.type||"jpg"!==o.type&&"png"!==o.type&&"jpeg"!==o.type?wx.showToast({title:"请上传jpg，jpeg，png格式图片",icon:"none",mask:!0,success:function(e){}}):t.policy(e,o)}})},policy:function(e,t){var o=this,i=this,n=Object(a.b)();console.log(e),console.log(t),Object(c.b)().then((function(a){var c=a;wx.uploadFile({url:c.host,filePath:e,name:"file",formData:{key:c.dir+"/"+n+"."+t.type,policy:c.policy,OSSAccessKeyId:c.accessid,callback:c.callback,signature:c.signature},success:function(e){if(200===e.statusCode){var t=JSON.parse(e.data);wx.getImageInfo({src:t.filename+"?x-oss-process=image/resize,p_10",success:function(e){i.checkImg(e.path,e,t.filename)},fail:function(){},complete:function(){}})}else o.flag=0,wx.showToast({title:"上传失败",icon:"none"})},fail:function(e){o.flag=0,wx.hideLoading(),console.log(e)}})}))},checkImg:function(e,t,o){var i=this,n=this;wx.uploadFile({url:"https://orgapi.miaogeban.com/org/home/checkImg",filePath:e,name:"file",success:function(e){var t=JSON.parse(e.data);if(50===e.code)return i.flag=0,void wx.showToast({title:"图片上传失败，请重试",icon:"none",mask:!0,success:function(e){}});0===t.data.errcode?"qrCode"===i.imageType?Object(r.m)({oid:n.baseInfo.org.id,path:o}).then((function(e){0===e.code?n.handleFun(o):(n.flag=0,wx.showToast({title:"图片上传失败，请重试",icon:"none",mask:!0,success:function(e){}}))})):n.handleFun(o):87014===t.data.errcode&&(o&&o.includes("https://img.miaogeban.com")&&Object(c.c)({path:o.split("?")[0]}),wx.hideLoading(),wx.showToast({title:"您上传的图片含敏感内容，请重新选择图片！",icon:"none",mask:!0,success:function(e){}}),i.flag=0)},fail:function(){i.flag=0,wx.showToast({title:"图片上传失败，请重试",icon:"none",mask:!0,success:function(e){}})},complete:function(){}})},handleFun:function(e){wx.hideLoading(),"background"===this.imageType?(u.a.commit("SET_BACKGROUND",{poster:e}),this.flag=0,wx.navigateBack({delta:2})):(u.a.commit("SET_IMAGEURL",e),this.flag=0,wx.navigateBack({delta:1}))}},mounted:function(){var e=this;l=this.$refs.cropper,setTimeout((function(){e.uploadTap()}),300)},onLoad:function(e){console.log(e),this.initCropper(e)},onUnload:function(){this.flag=0}}},ugYC:function(e,t,o){var i=o("woOf"),n=o.n(i),a=o("DWUZ"),c=o.n(a);t.a={name:"mpvue-cropper",props:{option:{type:Object}},data:function(){return{_wecropper:null}},computed:{_canvasId:function(){return this.option.id},_targetId:function(){return this.option.targetId},_width:function(){return this.option.width},_height:function(){return this.option.height},_pixelRatio:function(){return this.option.pixelRatio}},methods:{touchstart:function(e){this._wecropper.touchStart(e.mp)},touchmove:function(e){this._wecropper.touchMove(e.mp)},touchend:function(e){this._wecropper.touchEnd(e.mp)},pushOrigin:function(e){this._wecropper.pushOrign(e)},updateCanvas:function(){this._wecropper.updateCanvas()},getCropperBase64:function(e){return this._wecropper.getCropperBase64(e)},getCropperImage:function(e,t){return this._wecropper.getCropperImage(e,t)},init:function(){var e=this;this._wecropper=new c.a(n()(this.option,{id:this._canvasId,targetId:this._targetId,pixelRatio:this._pixelRatio})).on("ready",(function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];e.$emit.apply(e,["ready"].concat(o))})).on("beforeImageLoad",(function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];e.$emit.apply(e,["beforeImageLoad"].concat(o))})).on("imageLoad",(function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];e.$emit.apply(e,["imageLoad"].concat(o))})).on("beforeDraw",(function(){for(var t=arguments.length,o=Array(t),i=0;i<t;i++)o[i]=arguments[i];e.$emit.apply(e,["beforeDraw"].concat(o))}))}},onLoad:function(){if(!this.option)return console.warn("[mpvue-cropper] 请传入option参数\n参数配置见文档：https://we-plugin.github.io/we-cropper/#/api");this.init()}}},xZQz:function(e,t,o){t.a={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"upload-pic-wrapper"},[o("div",{staticClass:"cropper-buttons"},[o("div",{staticClass:"upload",attrs:{eventid:"0"},on:{tap:e.uploadTapAgain}},[e._v("选择图片")]),e._v(" "),o("div",{staticClass:"getCropperImage",attrs:{eventid:"1"},on:{tap:e.getCropperImage}},[e._v("保存")])]),e._v(" "),o("mpvue-cropper",{ref:"cropper",attrs:{option:e.cropperOpt,eventid:"2",mpcomid:"0"},on:{ready:e.cropperReady,beforeDraw:e.cropperBeforeDraw,beforeImageLoad:e.cropperBeforeImageLoad,beforeLoad:e.cropperLoad}})],1)},staticRenderFns:[]}}},["WaMn"]);