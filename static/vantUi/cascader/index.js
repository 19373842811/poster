var e,t=require("../../../@babel/runtime/helpers/toConsumableArray"),a=require("../common/component");!function(e){e.TEXT="text",e.VALUE="value",e.CHILDREN="children"}(e||(e={}));var i={text:e.TEXT,value:e.VALUE,children:e.CHILDREN};(0,a.VantComponent)({props:{title:String,value:{type:String,observer:"updateValue"},placeholder:{type:String,value:"请选择"},activeColor:{type:String,value:"#1989fa"},options:{type:Array,value:[],observer:"updateOptions"},swipeable:{type:Boolean,value:!1},closeable:{type:Boolean,value:!0},showHeader:{type:Boolean,value:!0},closeIcon:{type:String,value:"cross"},fieldNames:{type:Object,value:i,observer:"updateFieldNames"}},data:{tabs:[],activeTab:0,textKey:e.TEXT,valueKey:e.VALUE,childrenKey:e.CHILDREN},created:function(){this.updateTabs()},methods:{updateOptions:function(e,t){var a=!(!e.length||!t.length);this.updateTabs(a)},updateValue:function(e){var t=this;if(void 0!==e&&this.data.tabs.map((function(e){return e.selected&&e.selected[t.data.valueKey]})).indexOf(e)>-1)return;this.updateTabs()},updateFieldNames:function(){var e=this.data.fieldNames||i,t=e.text,a=void 0===t?"text":t,n=e.value,s=void 0===n?"value":n,l=e.children,o=void 0===l?"children":l;this.setData({textKey:a,valueKey:s,childrenKey:o})},getSelectedOptionsByValue:function(e,a){for(var i=0;i<e.length;i++){var n=e[i];if(n[this.data.valueKey]===a)return[n];if(n[this.data.childrenKey]){var s=this.getSelectedOptionsByValue(n[this.data.childrenKey],a);if(s)return[n].concat(t(s))}}},updateTabs:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=this.data,i=a.options,n=a.value;if(void 0!==n){var s=this.getSelectedOptionsByValue(i,n);if(s){var l=i,o=s.map((function(t){var a={options:l,selected:t},i=l.find((function(a){return a[e.data.valueKey]===t[e.data.valueKey]}));return i&&(l=i[e.data.childrenKey]),a}));return l&&o.push({options:l,selected:null}),this.setData({tabs:o}),void wx.nextTick((function(){e.setData({activeTab:o.length-1})}))}}if(t){var r=this.data.tabs;return r[r.length-1].options=i[i.length-1][this.data.childrenKey],void this.setData({tabs:r})}this.setData({tabs:[{options:i,selected:null}]})},onClose:function(){this.$emit("close")},onClickTab:function(e){var t=e.detail,a=t.index,i=t.title;this.$emit("click-tab",{title:i,tabIndex:a}),this.setData({activeTab:a})},onSelect:function(e){var t=this,a=e.currentTarget.dataset,i=a.option,n=a.tabIndex;if(!i||!i.disabled){var s=this.data,l=s.valueKey,o=s.childrenKey,r=this.data.tabs;if(r[n].selected=i,r.length>n+1&&(r=r.slice(0,n+1)),i[o]){var d={options:i[o],selected:null};r[n+1]?r[n+1]=d:r.push(d),wx.nextTick((function(){t.setData({activeTab:n+1})}))}this.setData({tabs:r});var u=r.map((function(e){return e.selected})).filter(Boolean),c={value:i[l],tabIndex:n,selectedOptions:u};this.$emit("change",c),i[o]||this.$emit("finish",c)}}}});